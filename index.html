
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Editor de Topos com Gerador</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #fff; }
        h1 { color: #e67300; }
        canvas { border: 1px solid #ccc; margin-top: 10px; background: #f0f8ff; }
        button, input { padding: 8px; margin-top: 10px; display: block; width: 100%; max-width: 400px; }
        #editor, #resultado { margin-top: 30px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
    </style>
</head>
<body onload="inicializar()">
    <h1>ðŸŽ‚ Gerador + Editor de Topos de Bolo</h1>
    <input type="text" id="tema" placeholder="Digite o tema (ex: Moana)" />
    <button onclick="gerarIdeia()">Gerar Ideia Criativa</button>

    <div id="resultado">
        <h3>âœ¨ PrÃ©via Visual</h3>
        <canvas id="preview" width="600" height="150"></canvas>
        <button id="btnTransferir" style="display:none;">Quero esse topo no editor</button>
    </div>

    <div id="editor" style="display:none;">
        <h3>ðŸŽ¨ Editor Interativo</h3>
        <canvas id="canvas" width="600" height="300"></canvas><br>
        <button onclick="add('circle')">Adicionar CÃ­rculo</button>
        <button onclick="add('rect')">Adicionar RetÃ¢ngulo</button>
        <button onclick="add('heart')">Adicionar CoraÃ§Ã£o</button>
        <button onclick="add('star')">Adicionar Estrela</button>
        <button onclick="baixar()">Baixar como SVG</button>
    </div>

    <script src="fabric.min.js"></script>
    <script>
        let canvas, preview, ultima = [];

        function inicializar() {
            canvas = new fabric.Canvas('canvas');
            preview = new fabric.Canvas('preview');
            preview.setBackgroundColor('#f0f8ff', preview.renderAll.bind(preview));
        }

        function gerarIdeia() {
            const tema = document.getElementById("tema").value.trim();
            if (!tema) return alert("Digite um tema!");

            ultima = [`Topo ${tema}`, "Feliz aniversÃ¡rio!"];
            preview.clear();
            let y = 30;
            ultima.forEach(t => {
                preview.add(new fabric.Text(t, { left: 50, top: y, fontSize: 24 }));
                y += 40;
            });
            preview.renderAll();
            document.getElementById("btnTransferir").style.display = "inline-block";
        }

        document.getElementById("btnTransferir").onclick = () => {
            document.getElementById("editor").style.display = "block";
            canvas.clear();
            let y = 50;
            ultima.forEach(t => {
                canvas.add(new fabric.Textbox(t, { left: 50, top: y, fontSize: 24 }));
                y += 60;
            });
        };

        fabric.Heart = fabric.util.createClass(fabric.Path, {
            initialize: function (options) {
                const path = 'M 272 200 C 272 120 176 160 176 80 C 176 160 80 120 80 200 C 80 280 176 320 176 400 C 176 320 272 280 272 200 Z';
                this.callSuper('initialize', path, options);
            }
        });
        fabric.Star = fabric.util.createClass(fabric.Polygon, {
            initialize: function (options) {
                const pts = [...Array(10)].map((_, i) => {
                    const a = i * Math.PI / 5;
                    const r = i % 2 === 0 ? 30 : 15;
                    return { x: 300 + r * Math.cos(a), y: 180 + r * Math.sin(a) };
                });
                this.callSuper('initialize', pts, options);
            }
        });

        function add(tipo) {
            let forma;
            switch (tipo) {
                case 'circle': forma = new fabric.Circle({ radius: 30, fill: 'pink', left: 150, top: 100 }); break;
                case 'rect': forma = new fabric.Rect({ width: 80, height: 50, fill: 'lightblue', left: 180, top: 120 }); break;
                case 'heart': forma = new fabric.Heart({ fill: 'red', scaleX: 0.2, scaleY: 0.2, left: 200, top: 90 }); break;
                case 'star': forma = new fabric.Star({ fill: 'gold', left: 250, top: 100 }); break;
            }
            if (forma) canvas.add(forma);
        }

        function baixar() {
            const svg = canvas.toSVG();
            const b = new Blob([svg], { type: "image/svg+xml" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(b);
            a.download = "topo_bolo.svg";
            a.click();
        }
    </script>
</body>
</html>
